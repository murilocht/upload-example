{"ast":null,"code":"import _objectSpread from \"/home/murilocht/Documentos/projetos/reactjs/uploadexample/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/home/murilocht/Documentos/projetos/reactjs/uploadexample/frontend/src/App.js\";\nimport React, { Component } from 'react';\nimport { uniqueId } from 'lodash';\nimport filesize from 'filesize';\nimport GlobalStyle from './styles/global';\nimport { Container, Content } from './styles';\nimport api from './services/api';\nimport Upload from './components/Upload';\nimport FileList from './components/FileList';\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      uploadedFiles: []\n    };\n\n    this.handleUpload = files => {\n      const uploadedFiles = files.map(file => ({\n        file,\n        id: uniqueId(),\n        name: file.name,\n        readableSize: filesize(file.size),\n        preview: URL.createObjectURL(file),\n        progress: 0,\n        uploaded: false,\n        url: null\n      }));\n      this.setState({\n        uploadedFiles: this.state.uploadedFiles.concat(uploadedFiles)\n      });\n      uploadedFiles.forEach(this.processUpload);\n    };\n\n    this.updateFile = (id, data) => {\n      this.setState({\n        uploadedFiles: this.state.uploadedFiles.map(uploadedFile => {\n          return id === uploadedFile.id ? _objectSpread({}, uploadedFile, {}, data) : uploadedFile;\n        })\n      });\n    };\n\n    this.processUpload = uploadedFile => {\n      const data = new FormData();\n      data.append('file', uploadedFile.file, uploadedFile.name);\n      api.post('posts', data, {\n        onUploadProgress: e => {\n          const progress = parseInt(Math.round(e.loaded * 100 / e.total));\n          this.updateFile(uploadedFile.id, {\n            progress\n          });\n        }\n      }).then(response => {\n        this.updateFile(uploadedFile.id, {\n          uploaded: true,\n          id: response.data._id,\n          url: response.data.url\n        });\n      }).catch(() => {\n        this.updateFile(uploadedFile.id, {\n          error: true\n        });\n      });\n    };\n  }\n\n  render() {\n    const uploadedFiles = this.state.uploadedFiles;\n    return React.createElement(Container, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, React.createElement(Content, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73\n      },\n      __self: this\n    }, React.createElement(Upload, {\n      onUpload: this.handleUpload,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    }), !!uploadedFiles.length && React.createElement(FileList, {\n      files: uploadedFiles,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    })), React.createElement(GlobalStyle, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/murilocht/Documentos/projetos/reactjs/uploadexample/frontend/src/App.js"],"names":["React","Component","uniqueId","filesize","GlobalStyle","Container","Content","api","Upload","FileList","App","state","uploadedFiles","handleUpload","files","map","file","id","name","readableSize","size","preview","URL","createObjectURL","progress","uploaded","url","setState","concat","forEach","processUpload","updateFile","data","uploadedFile","FormData","append","post","onUploadProgress","e","parseInt","Math","round","loaded","total","then","response","_id","catch","error","render","length"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { uniqueId } from 'lodash';\nimport filesize from 'filesize';\n\nimport GlobalStyle from './styles/global';\nimport { Container, Content } from './styles';\nimport api from './services/api';\n\nimport Upload from './components/Upload';\nimport FileList from './components/FileList';\n\nclass App extends Component {\n  state = {\n    uploadedFiles: []\n  };\n\n  handleUpload = files => {\n    const uploadedFiles = files.map(file => ({\n      file,\n      id: uniqueId(),\n      name: file.name,\n      readableSize: filesize(file.size),\n      preview: URL.createObjectURL(file),\n      progress: 0,\n      uploaded: false,\n      url: null\n    }))\n\n    this.setState({\n      uploadedFiles: this.state.uploadedFiles.concat(uploadedFiles)\n    });\n\n    uploadedFiles.forEach(this.processUpload)\n  };\n\n  updateFile = (id, data) => {\n    this.setState({ uploadedFiles: this.state.uploadedFiles.map(uploadedFile => {\n      return id === uploadedFile.id ? { ...uploadedFile, ...data } : uploadedFile;\n    }) })\n  };\n\n  processUpload = (uploadedFile) => {\n    const data = new FormData();\n\n    data.append('file', uploadedFile.file, uploadedFile.name);\n\n    api.post('posts', data,  {\n      onUploadProgress: e => {\n        const progress = parseInt(Math.round((e.loaded * 100) / e.total));\n\n        this.updateFile(uploadedFile.id, {\n          progress\n        });\n      } \n    }).then(response => {\n      this.updateFile(uploadedFile.id, {\n        uploaded: true,\n        id: response.data._id,\n        url: response.data.url\n      });\n    }).catch(() => {\n      this.updateFile(uploadedFile.id, {\n        error: true\n      });\n    });\n  };\n\n  render() {\n    const { uploadedFiles } = this.state;\n\n    return (\n      <Container>\n        <Content>\n          <Upload onUpload={this.handleUpload}/>\n          { !!uploadedFiles.length && (\n            <FileList files={uploadedFiles}/>\n          ) } \n        </Content>\n\n        <GlobalStyle />\n      </Container>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}